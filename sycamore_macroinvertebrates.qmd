---
title: "Final Project: Exploratory Analysis"
format: html
execute:
  message: false
  warning: false
---

```{r}
# Load packages & theme
library(tidyverse)
set_theme(theme_classic(10))
```

[EDI Data Link](https://portal.edirepository.org/nis/mapbrowse?packageid=knb-lter-cap.589.2)

```{r}
# Load data
sycamore_invertebrates <- read_csv(here::here('data', 'sycamorecreek_invertebrates.csv'))
```

```{r}
# Create new datetime column
sycamore_invertebrates$date <- as_datetime(sycamore_invertebrates$year_month, format = '%Y-%m')

# Create new season column
sycamore_invertebrates <- sycamore_invertebrates |> 
  mutate(season = case_when(month(date) %in% c(3, 4, 5) ~ "Spring",
                            month(date) %in% c(6, 7, 8) ~ "Summer",
                            month(date) %in% c(9, 10, 11) ~ "Fall",
                            month(date) %in% c(12, 1, 2) ~ "Winter",)) # Records were only collected during Spring & Summer

# Create new year & month column
sycamore_invertebrates <- sycamore_invertebrates |> 
  mutate(year = year(date)) |> 
  mutate(month = month(date))

```

```{r}
# Initial taxon-date plot
ggplot(sycamore_invertebrates, aes(date, count)) +
  geom_jitter(aes(color = taxon)) +
  theme(legend.position = 'none')
```

There are too many taxons to see a relationship, also observations seem to be grouped throughout time.

```{r}
# Find value counts
taxon_counts <- sycamore_invertebrates |> 
  count(taxon, sort = TRUE)
```

```{r}
# Find top 10 most frequent taxons
top10 <- taxon_counts$taxon[1:10]
top10
```

```{r}
# Filter original df
filtered_top10 <- sycamore_invertebrates |> 
  filter(taxon %in% top10)
```

```{r}
# Plot filtered data
ggplot(filtered_top10, aes(date, count)) +
  geom_jitter(aes(color = taxon)) 
```

Any relationship is still not quite clear, try aggregating.

```{r}
# Aggregate data by season
season_counts <- filtered_top10 |> 
  group_by(taxon, season) |> 
  summarise(count_total = sum(count))

# Aggregate data by year
year_counts <- filtered_top10 |> 
  group_by(taxon, year, month) |> 
  summarise(count_total = sum(count))
```


```{r}
# Scatter plot for top10 taxons per season
ggplot(season_counts, aes(season, count_total, color = taxon)) +
  geom_jitter(size = 5)
```

```{r fig.width=10, fig.height=7}
# Scatter plot for top10 taxons per year
ggplot(year_counts, aes(month, count_total, color = taxon)) +
  geom_jitter() +
  facet_wrap(~year, nrow = 2)
```

The question I had in mind was if seasons could be a predictor of taxon groups, or even taxonomic composition within this data. After this exploratory investigation, the only seasons that data was recorded in are spring and summer and so far, a relationship is not clear even after aggregating a couple ways. Another way to aggregate is to find the composition of each of the top10 taxons and maybe plot some relationship that way.
